!function(){"use strict";function t([t,...e],...s){return s.reduce((t,s)=>t.concat(s,e.shift()),[t]).filter(t=>null!=t).join("")}function e(t,e){return e?`'event.preventDefault();dispatch(${JSON.stringify(t)})'`:setTimeout(rt,0,t)}const s=()=>W(-1,{}),n=t=>W(31,{entities:t.reduce((t,e)=>C(t,{[e.id]:e}),{})}),i=(t,e)=>{const s=t.db.entities;return s&&s[e]},r=(t,e={})=>{const s=new URLSearchParams;U(e).forEach(t=>s.set(t,e[t]));const n=`https://hacker-news.firebaseio.com/v0//${t}.json?${s}`;return F(n).then(t=>t.json())},c=t=>Promise.all(t.map(t=>r(`item/${t}`))),a=(t,e=20)=>r((t||"top")+"stories"),o=t=>r(`user/${t}`).then(t=>C(t,{type:"user"})),d=t=>W(1,{id:t}),u=(t,e)=>W(2,{id:t,submissions:e}),l=(t,e)=>W(3,{id:t,error:e}),p=t=>(a(t).then(s=>e(u(t,s))).catch(s=>e(l(t,s))),d(t)),m=t=>W(5,{ids:t}),h=t=>(e(W(6,{ids:t.map(({id:t})=>t)})),n(t)),$=(t,e)=>W(7,{error:t,ids:e}),v=t=>{const s=t.map(M);return c(s).then(t=>e(h(t))).catch(t=>e($(t,s))),m(s)},y=t=>W(8,{id:M(t)}),f=t=>W(9,{id:t}),g=t=>(e(W(10,{id:t.id})),n([t])),b=(t,e)=>W(11,{error:t,id:e}),w=t=>(o(t).then(t=>e(g(t))).catch(s=>e(b(s,t))),f(t)),x=(t,e,s)=>{const{id:n,ids:i}=e.payload;if(!n&&!i)return t;const r=i||n&&[n]||[];return C(t,{requesting:C(t.requesting,r.reduce((t,e)=>C(t,{[e]:s}),{}))})},k=t=>t.submissions,q=t=>k(t).requesting,j=t=>k(t).expanded,I=(t,e)=>k(t).items[e],S=localStorage,E=URLSearchParams,L=Date.now,M=Number,O=t=>`${t}`,R=t=>!!t&&"story"===t.type,N=t=>!!t&&"comment"===t.type,P=t=>"string"==typeof t,B=Math.max,T=Math.round,U=Object.keys,C=(...t)=>Object.assign({},...t),D=(t,s)=>{const n=i(t,s),r=q(t);if(n)return n;r[s]||e(v([s]))},F=(t,e)=>{const s=`_in_${t}`,n=S.getItem(s),i=S.getItem(s+":ts");if(n&&i){if((L()-M(i))/1e3<300){const t=new Response(new Blob([n]));return Promise.resolve(t)}S.removeItem(s),S.removeItem(s+":ts")}return fetch(t,e).then(t=>{if(200===t.status){const e=t.headers.get("Content-Type");e&&(e.match(/application\/json/i)||e.match(/text\//i))&&t.clone().text().then(t=>{S.setItem(s,t),S.setItem(s+":ts",O(L()))})}return t})},_=t=>[...new E(t)].reduce((t,[e,s])=>C(t,{[e]:s}),{}),H=t=>{const e=new E;return U(t).forEach(s=>e.set(s,t[s])),O(e)},J=t=>1===t?" ago":"s ago",z=(t,e,s)=>{const n=T(t/e);return n+" "+s+J(n)},A=t=>{const e=L()-1e3*t;switch(!0){case e>864e5:return z(e,864e5,"day");case e>36e5:return z(e,36e5,"hour");case e>6e4:return z(e,6e4,"minute");default:return"less than a minute ago"}},G=/https?:&#x2F;&#x2F;news\.ycombinator\.com/g,{protocol:K,host:Q}=location,V=(t="")=>t.replace(G,`${K}//${Q}`),W=(t,e)=>({type:t,payload:e}),X=(t,e)=>W(22,{path:t,query:e}),Y=["new","comments","","item","show","ask","user"],Z=()=>{const t=location.pathname.slice(1),e=-1!==Y.indexOf(t),s=_(location.search),n=e?t:"";return e||history.pushState({},"Innerself News","/"),{path:n,query:s}},tt=t=>t.router,et=t=>tt(t).query||{},st=t=>tt(t).path,nt=((...t)=>{const e=t.pop();return e?s=>t.reduceRight((t,e)=>e(t),e(s)):t=>t})((window.addEventListener("popstate",()=>e(W(21,Z()))),t=>{switch(t.type){case 22:{const{payload:e}=t,{path:s,query:n}=e,i=n&&H(n);return history.pushState({},s,(s||"/")+(i?"?"+i:"")),W(21,e)}}return t}));const it=(t=>{const e=U(t),n=s();return(s,i=n)=>e.reduce((e,s)=>(e[s]=t[s](e[s],i),e),s||{})})({router:(t=Z(),{type:e,payload:s})=>{switch(e){case 21:return C(s,{previous:C(t,{previous:void 0})});default:return t}},submissions:(t={requesting:{},expanded:{},items:{}},e)=>{switch(e.type){case 4:return C(t,{items:{}});case 1:return x(t,e,!0);case 2:{const s=e.payload.id;return C(x(t,e,!1),{items:C(t.items,{[s]:e.payload.submissions})})}case 3:return C(x(t,e,!1),{error:e.payload.error});case 9:case 5:return x(t,e,!0);case 10:case 11:case 6:case 7:return x(t,e,!1);case 8:{const{id:s}=e.payload,{expanded:n}=t;return C(t,{expanded:C(n,{[s]:!n[s]})})}}return t},db:(t={entities:{}},e)=>{switch(e.type){case 31:return C(t,{entities:C(t.entities,e.payload.entities)});default:return t}}}),{dispatch:rt,connect:ct,attach:at}=function(t){function e(){for(const[t,e]of n){const n=e();if(n!==i.get(t)){i.set(t,n),t.innerHTML=n;const e=new CustomEvent("render",{detail:s});t.dispatchEvent(e)}}}let s=t();const n=new Map,i=new Map;return{attach(t,s){n.set(s,t),e()},connect:t=>(...e)=>t(s,...e),dispatch(n,...i){s=t(s,n,i),e()}}}((t=>(e,s)=>t(e,s&&nt(s)))(it));window.dispatch=e;const ot=(t,s)=>e(X(t,s),!0),dt=e=>{const{path:s,text:n,query:i={},cls:r=""}=e,c=H(i);return t` <a href="/${s+(c?`?${c}`:"")}" class="${r} client-link" onclick=${ot(s,i)}> ${n||s} </a> `},ut=()=>t`<div class="loader"></div>`,lt=(s,n)=>t` <a class="${"comment"}-expand" onclick=${e(y(s),!0)}> ${n} </a> `,pt=ct((e,s)=>{const{id:n,compact:i,child:r}=s,c=j(e),a=D(e,n);if(!N(a))return"";const o=a.by?dt({path:"user",text:`${a.by}`,cls:`comment-link`,query:{id:a.by||""}}):"[deleted]",d=dt({path:"item",text:A(a.time),cls:`${mt}-link`,query:{id:`${a.id}`}}),u=i&&dt({path:"item",text:"parent",cls:`${mt}-link`,query:{id:`${a.parent}`}}),l=a.kids||[],p=c[n]?lt(n,`hide children`):lt(n,`show children (${l.length})`),m=l.length&&!i,h=m&&c[n]?l.map(t=>pt({id:t,child:!0})).join("")||ut():"";return t` <div class="${"comment"}${r?"comment -child":""}"> <div class="${"comment"}-info"> ${o} ${d} ${u?"| "+u:""} </div> <div class="${"comment"}-text"> ${V(a.text)} </div> ${m?p:""} ${V(h)} </div> `}),mt="article",ht=({item:e,index:s,text:n})=>{const i=dt({path:"user",text:`${e.by}`,cls:`${mt}-link`,query:{id:e.by||""}}),r=dt({path:"item",text:`${e.descendants||0} comments`,cls:`${mt}-link`,query:{id:`${e.id}`}}),c=void 0!==s?t`<div class="${mt}-index"> ${s+1}. </div>`:"",a=n?t` <div class="${mt}-text"> ${e.text} </div> `:"",o=e.url,d=o&&new URL(o).hostname;return t` <div class="${mt}"> ${c} <div> <a class="${mt}-title" href="${o||"#"}">${e.title}</a> ${d?`<div class="host">(${d.replace("www.","")})</div>`:""} <div class="${mt}-info"> ${e.score} points by ${i} ${A(e.time)} | ${r} </div> ${a} </div> </div> `},$t=ct((e,s)=>{const{items:n,skip:r=0}=s,c=n.map(t=>i(e,t)).filter(R);return t` <div class="${mt}-list"> ${c.length?c.map((t,e)=>ht({item:t,index:e+r||0})):"(no items)"} </div> `}),vt=ct((t,e)=>{const s=et(t),n=st(t);return dt({path:n,text:"previous",query:C(s,{skip:B(0,e-20)})})}),yt=ct((t,e)=>{const s=et(t),n=st(t);return dt({path:n,text:"next",query:C(s,{skip:e+20})})}),ft=(t,s)=>{const n=I(t,s),r=q(t),c=et(t);if(!n)return r[s]||e(p(s)),ut();const a="skip"in c?M(c.skip):0,o=n.slice(a,a+20),d=o.filter(e=>!i(t,e));if(d.length){const t=d.filter(t=>!r[t]);return t.length&&e(v(t)),ut()}{const t=a+20<n.length,e=0!==a;return`\n ${$t({items:o,skip:a})}\n <div class="paging-controls">\n ${e?vt(a):""}\n ${e&&t?" | ":""}\n ${t?yt(a):""}\n </div>\n `}},gt=()=>t`Oops, not found...`,bt=e=>{const{id:s=""}=et(e);if(!s)return gt();const n=D(e,s);if(!R(n)&&!N(n))return ut();const{kids:i}=n,r=i?i.map(t=>pt({id:t})).join(""):"(no comments)";return t` ${N(n)?pt({id:s,compact:!0}):ht({item:n,text:!0})} <div class="comments"> ${""===r?ut():r} </div> `},wt=ct((t,e)=>{const s=st(t)===e.path,n=(e.cls||"")+" navbar-link "+(s?"active":"");return dt(C(e,{cls:n,query:{}}))}),xt=[{path:"new"},{path:"show"},{path:"ask"}],kt=()=>t` <div class="navbar"> <div class="navbar-links"> ${wt({path:"",cls:"logo",text:"Innerself News"})} ${xt.map(wt).join(" | ")} </div> <a class="navbar-link" href="https://github.com/bsouthga/innerself-hn"> <img src="github.svg" /> </a> </div> `,qt=t=>t?`<div class="submitted-item">${t.trim()}</div>`:"",jt=s=>{const n=It(s),r=q(s),c=et(s),a=st(s);if(P(n))return n;const{submitted:o=[]}=n,d=o.length,u="skip"in c?M(c.skip):0,l="type"in c?c.type:"all",p=o.slice(u,u+20),m=p.filter(t=>!i(s,t));if(m.length){const t=m.filter(t=>!r[t]);t.length&&e(v(t))}const h=0!==u,$=u+20<d,y="all"===l,f=y||"comments"===l,g=y||"stories"===l,b=m.length?ut():p.map(t=>{const e=i(s,t);switch(!0){case N(e):return f?pt({id:t,compact:!0}):"";case R(e):return g?ht({item:e}):""}}).map(qt).join(""),w=[{text:`show all`,query:C(c,{type:"all"})},{text:`comments only`,query:C(c,{type:"comments"})},{text:`stories only`,query:C(c,{type:"stories"})}];return t` <div class="${"submitted"}"> <div class="${"submitted"}-title"> submissions by ${n.id} </div> <div class="paging-controls"> ${h?vt(u)+"|":""} ${w.map(t=>dt(C({cls:t.query.type===l?"active":"",path:a},t))).join("|")} ${$?"|"+yt(u):""} </div> <div class="${"submitted"}-content"> ${b||"(none)"} </div> </div> `},It=t=>{const{id:s=""}=et(t),n=q(t);if(!s)return gt();const r=i(t,s);return r&&"user"!==r.type?gt():r||(n[s]||e(w(s)),ut())},St=(t,e)=>`<tr><td>${t}:</td><td>${e}</td></tr>`,Et=e=>{const s=It(e);return P(s)?s:t` <table> ${[St("user",s.id),St("created",A(s.created)),St("karma",s.karma),St("about",s.about||"blank")]} </table> ${jt(e)} `},Lt=ct(t=>{const e=st(t);switch(e){case"":case"new":case"ask":case"show":return ft(t,e);case"item":return bt(t);case"user":return Et(t);default:return gt()}});at(()=>t` <div class="container"> ${kt()} <div class="content"> ${Lt()} </div> <div class="footer"> <a href="https://bsou.io">Ben Southgate</a> | 2017 </div> </div> `,document.getElementById("root"))}();
